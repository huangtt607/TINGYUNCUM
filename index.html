<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="黃庭筠的顏射互動網站 - 在線射精體驗">
  <meta name="keywords" content="黃庭筠,顏射,射精,互動體驗,成人內容">
  <meta name="author" content="黃庭筠">
  <meta name="robots" content="index, follow">
  <meta property="og:title" content="黃庭筠的顏射體驗">
  <meta property="og:description" content="黃庭筠的顏射互動網站 - 在線射精體驗">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://huangtt607.github.io/TINGYUNCUM/">
  <meta property="og:image" content="images/profiles/preview.jpg">
  <title>黃庭筠的顏射體驗</title>
  <link rel="icon" type="image/png" href="images/favicon.png">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9FVCBCYPZF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-9FVCBCYPZF');
  </script>
  <style>
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Microsoft JhengHei', Arial, sans-serif;
      background-color: #ff69b4; color: #fff;
      overflow-x: hidden; display: flex; flex-direction: column;
    }
    .container {
      max-width: 1200px; /* 增加最大寬度 */
      width: 95%; /* 使用百分比寬度以適應不同設備 */
      padding: 10px; box-sizing: border-box;
      text-align: center; margin: 0 auto;
      display: flex; flex-direction: column; height: 100%;
    }
    h1 { 
      font-size: 28px; 
      margin: 10px 0; 
      line-height: 1.2; 
      z-index: 2; 
      position: relative; 
    }
    .subtitle { 
      font-size: 18px; 
      margin: 5px 0 15px 0; 
      line-height: 1.2; 
      z-index: 2; 
      position: relative; 
    }
    #canvas-container {
      position: relative; 
      width: 100%; 
      margin: 0 auto 15px auto; 
      flex: 1;
      display: flex; 
      align-items: center; 
      justify-content: center;
      overflow: hidden;
    }
    #main-canvas {
      max-width: 100%;
      max-height: 80vh; /* 增加最大高度 */
      height: auto;
      display: block; 
      border-radius: 10px;
      object-fit: contain;
    }
    .target-text {
      position: absolute; color: #ff1493; font-weight: bold;
      font-size: 18px; text-shadow: 1px 1px 2px black;
      cursor: move; user-select: none; z-index: 10;
    }
    #aim-circle {
      position: absolute; border: 2px solid red; border-radius: 50%;
      width: 40px; height: 40px; pointer-events: none;
      display: none; z-index: 20;
    }
    #aim-center {
      position: absolute; background-color: red; width: 4px; height: 4px;
      border-radius: 50%; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
    }
    .button {
      display: inline-block; padding: 10px 0; background-color: #ff1493;
      color: white; text-align: center; text-decoration: none;
      font-size: 16px; border-radius: 5px; border: none; cursor: pointer;
    }
    .small-button { 
      width: calc(25% - 8px); 
      margin: 0 4px 8px 0; 
    }
    #fixed-controls {
      position: fixed; 
      top: 10px; 
      left: 50px; /* 從10px改為50px，使按鈕不貼邊 */
      z-index: 1000;
      display: flex; 
      flex-direction: column;
    }
    #fixed-controls button {
      background-color: #ff1493; color: white; border: none;
      padding: 8px 10px; border-radius: 5px; cursor: pointer;
      margin-bottom: 5px; font-size: 14px; display: none;
      opacity: 0.8;
      text-align: left;
      width: 140px; /* 固定寬度，使所有按鈕大小一致 */
    }
    #fixed-controls button:hover {
      opacity: 1;
    }
    .controls-footer { 
      width: 100%; 
      margin-top: auto; 
      max-width: 800px; /* 控制區域最大寬度 */
      margin-left: auto;
      margin-right: auto;
    }
    .info { 
      font-size: 16px; line-height: 1.3; margin: 5px 0;
      padding: 0 5px; color: rgba(255, 255, 255, 0.9);
    }
    .input-group { display: flex; margin-bottom: 8px; }
    #custom-text-input {
      flex: 1; padding: 10px; border: none; border-radius: 5px 0 0 5px;
      box-sizing: border-box; font-size: 16px; height: 40px;
    }
    #add-text-button {
      width: 100px; border-radius: 0 5px 5px 0; margin: 0;
    }
    .controls-container {
      display: flex; flex-wrap: wrap; justify-content: space-between;
    }
    .screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.9); display: flex;
      flex-direction: column; justify-content: center; align-items: center;
      z-index: 9999;
    }
    #warning-screen { z-index: 10000; padding: 20px; box-sizing: border-box; text-align: center; }
    #warning-screen h2 { color: red; font-size: 32px; margin-bottom: 20px; }
    #warning-screen p { color: white; font-size: 18px; margin-bottom: 30px; max-width: 800px; }
    .action-button {
      padding: 15px 40px; background-color: #ff1493; color: white;
      border: none; border-radius: 5px; font-size: 20px;
      cursor: pointer; margin: 10px;
    }
    #exit-button { background-color: #666; }
    .spinner {
      border: 5px solid #f3f3f3; border-top: 5px solid #ff1493;
      border-radius: 50%; width: 50px; height: 50px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .progress-container {
      width: 80%; max-width: 400px; background-color: #444;
      border-radius: 10px; margin-top: 20px;
    }
    #progress-bar {
      height: 20px; background-color: #ff1493; border-radius: 10px;
      width: 0%; transition: width 0.3s;
    }
    #progress-text { color: white; margin-top: 5px; font-size: 16px; }
    #custom-image-modal {
      display: none; position: fixed; top: 0; left: 0;
      width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9);
      z-index: 10001; flex-direction: column;
      justify-content: center; align-items: center; padding: 20px;
      box-sizing: border-box;
      overflow-y: auto; /* 添加垂直滾動 */
    }
    #help-modal {
      display: none; position: fixed; top: 0; left: 0;
      width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9);
      z-index: 10001; overflow-y: auto; /* 確保可以滾動 */
      padding: 0; /* 移除padding，避免內容超出畫面 */
    }
    #help-modal h3 { 
      color: white; 
      margin-bottom: 15px; 
      font-size: 28px;
      text-shadow: 0 0 10px #ff1493;
    }
    #help-modal p {
      color: white; margin-bottom: 15px; text-align: left;
      max-width: 800px; line-height: 1.6;
      font-size: 16px;
    }
    #help-modal strong {
      color: #ff1493;
      font-size: 18px;
    }
    #help-modal img {
      max-width: 90%;
      max-height: 250px; /* 進一步減小圖片高度 */
      margin: 15px 0;
      border-radius: 5px;
      box-shadow: 0 0 20px rgba(255, 20, 147, 0.5);
    }
    #help-modal .modal-content {
      background-color: rgba(0, 0, 0, 0.7);
      padding: 20px;
      border-radius: 10px;
      max-width: 800px;
      width: 90%;
      margin: 30px auto; /* 增加上下邊距，確保內容不會貼邊 */
      border: 1px solid #ff1493;
      position: relative; /* 添加相對定位 */
    }
    #help-modal .feature-section {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.3);
    }
    #help-modal .feature-title {
      font-size: 20px;
      color: #ff1493;
      margin-bottom: 10px;
    }
    #custom-image-modal h3 { color: white; margin-bottom: 20px; font-size: 24px; }
    #custom-image-modal p {
      color: white; margin-bottom: 20px; text-align: center;
      max-width: 800px; font-size: 16px; line-height: 1.5;
    }
    #custom-image-input { display: none; }
    #custom-image-label {
      background-color: #ff1493; color: white; padding: 12px 25px;
      border-radius: 5px; cursor: pointer; margin-bottom: 20px;
      font-size: 16px;
    }
    #custom-image-preview {
      max-width: 80%; 
      max-height: 250px; /* 減小預覽圖片高度 */
      margin: 10px 0; /* 減小上下邊距 */
      border-radius: 5px; 
      display: none;
    }
    .modal-buttons { display: flex; justify-content: center; gap: 15px; }
    .modal-button { 
      padding: 10px 20px; 
      border: none; 
      border-radius: 5px; 
      cursor: pointer; 
      font-size: 16px;
    }
    #apply-custom-image { background-color: #ff1493; color: white; }
    #cancel-custom-image, #reset-default-image, #close-help { background-color: #666; color: white; }
    
    /* 右側功能按鈕 */
    .right-controls {
      position: fixed;
      top: 10px;
      right: 50px; /* 從10px改為50px，使按鈕不貼邊 */
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }
    
    /* 切換照片按鈕 */
    #profile-switcher {
      position: fixed;
      bottom: 15px;
      right: 50px; /* 從15px改為50px，使按鈕不貼邊 */
      z-index: 100;
      background-color: rgba(255, 105, 180, 0.7);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      color: white;
      border: 2px solid white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    #profile-switcher:hover {
      background-color: rgba(255, 20, 147, 0.9);
    }
    
    /* 幫助按鈕 */
    #help-button {
      background-color: rgba(255, 105, 180, 0.7);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 22px;
      font-weight: bold;
      color: white;
      border: 2px solid white;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      margin-bottom: 10px;
    }
    #help-button:hover {
      background-color: rgba(255, 20, 147, 0.9);
    }
    
    #shooting-tip {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 12px 20px;
      border-radius: 5px;
      font-size: 16px;
      z-index: 1000;
      display: none;
      text-align: center;
      max-width: 80%;
    }
    
    /* 手機版文字控制按鈕 */
    .mobile-text-controls {
      position: fixed;
      bottom: 70px;
      left: 50%;
      transform: translateX(-50%);
      display: none;
      flex-direction: row;
      justify-content: center;
      gap: 10px;
      z-index: 1000;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 10px;
      border-radius: 5px;
      width: auto;
    }
    
    .mobile-text-controls button {
      background-color: #ff1493;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      opacity: 0.9;
    }
    
    .mobile-text-controls button:hover {
      opacity: 1;
    }
    
    /* 媒體查詢，針對移動設備 */
    @media (max-width: 768px) {
      .container {
        width: 100%; /* 在手機上使用全寬 */
        padding: 5px;
      }
      h1 {
        font-size: 22px;
      }
      .subtitle {
        font-size: 16px;
      }
      #fixed-controls {
        display: none; /* 在手機上隱藏桌面版控制按鈕 */
      }
      .right-controls {
        right: 20px; /* 在手機上減小右側邊距 */
      }
      #profile-switcher {
        right: 20px; /* 在手機上減小右側邊距 */
      }
      .small-button { 
        width: calc(50% - 4px); /* 在手機上每行顯示兩個按鈕 */
        font-size: 14px;
        padding: 8px 0;
      }
      #main-canvas {
        max-height: 70vh;
      }
      .target-text {
        font-size: 16px;
      }
      #custom-text-input {
        height: 36px;
        font-size: 14px;
      }
      #add-text-button {
        width: 80px;
        font-size: 14px;
      }
      #help-modal .modal-content {
        padding: 15px;
        margin: 20px auto;
        width: 95%;
      }
      #help-modal h3 {
        font-size: 22px;
      }
      #help-modal p {
        font-size: 14px;
      }
      #custom-image-preview {
        max-height: 200px; /* 在手機上進一步減小預覽圖片高度 */
      }
    }
  </style>
</head>
<body>
  <div id="warning-screen" class="screen">
    <h2>⚠️ 18禁內容警告 ⚠️</h2>
    <p>本網站包含成人內容，僅供年滿18歲以上成人瀏覽。<br>
    若您未滿18歲，請立即離開。<br>
    點擊「進入網站」代表您已確認年滿18歲，並同意觀看相關內容。</p>
    <div>
      <button id="enter-button" class="action-button">進入網站</button>
      <button id="exit-button" class="action-button">離開</button>
    </div>
  </div>
  
  <div id="loading-screen" class="screen" style="display:none;">
    <div>資源載入中...</div>
    <div class="spinner"></div>
    <div class="progress-container">
      <div id="progress-bar"></div>
    </div>
    <div id="progress-text">0%</div>
  </div>
  
  <div id="custom-image-modal">
    <h3>上傳自定義照片</h3>
    <p>選擇一張照片作為底圖，替換原本的人物圖像。<br>支援JPG、PNG格式，推薦使用PNG格式以獲得最佳效果。<br>為了最佳效果，請選擇清晰的正面照片。</p>
    <label id="custom-image-label" for="custom-image-input">選擇照片</label>
    <input type="file" id="custom-image-input" accept="image/jpeg,image/png">
    <img id="custom-image-preview">
    <div class="modal-buttons">
      <button id="apply-custom-image" class="modal-button" disabled>套用照片</button>
      <button id="reset-default-image" class="modal-button">還原預設圖片</button>
      <button id="cancel-custom-image" class="modal-button">取消</button>
    </div>
  </div>
  
  <div id="help-modal">
    <div class="modal-content">
      <h3>黃庭筠的顏射體驗 - 使用說明</h3>
      
      <div class="feature-section">
        <div class="feature-title">🔍 黃庭筠是誰？</div>
        <p>黃庭筠，台灣世新大學傳播管理學系學生，學號A103210095，生於1995年12月13日。她不僅身材前凸後翹，而且是個不折不扣的反差騷貨，在上學期間就荣獲萬人騎的稱號，對於所有炮友的要求都有求必應。</p>
        <p>據她的炮友透露，黃庭筠最喜歡被顏射，每次被射在臉上時都會露出滿足的表情，並用舌頭舔食嘴邊的精液。她還會主動要求拍照留念，並將這些照片珍藏在私人相冊中。</p>
        <p>她的口技尤其出名，能夠深喉到根部而不嘔吐，舌頭靈活地舔弄龜頭和柱身，時不時還發出淫蕩的呻吟聲。她的嘴唇柔軟濕潤，總是塗著鮮豔的口紅，讓人忍不住想射在她臉上，看著白濁的精液順著她精緻的臉蛋滑落。</p>
        <img src="images/help/student_id.jpg" alt="黃庭筠學生證">
      </div>
      
      <div class="feature-section">
        <div class="feature-title">🎮 網站功能說明</div>
        
        <p><strong>1. 添加羞辱文字</strong><br>
        在輸入框中輸入任何你想對這賤貨說的話，點擊「添加文字」按鈕將文字添加到圖片上。你也可以點擊「隨機文字」按鈕添加預設的羞辱文字，讓她知道自己有多賤。</p>
        
        <p><strong>2. 移動和編輯文字</strong><br>
        點擊並拖動文字可以調整其位置，將羞辱文字放在她最敏感的部位。點擊文字後，會出現放大、縮小和刪除按鈕，讓你完全控制文字的大小和位置。</p>
        
        <p><strong>3. 射精功能</strong><br>
        點擊「射爆她！」按鈕進入射精模式，然後點擊圖片任意位置進行射精。你可以射在她的臉上、嘴裡、眼睛上，或任何你想射的地方，看著精液覆蓋她的臉蛋。</p>
        
        <p><strong>4. 切換照片</strong><br>
        點擊右下角的循環按鈕可以切換不同的預設照片。我們提供了6張黃庭筠的不同照片，讓你可以在不同角度和表情上射精和羞辱她。</p>
        
        <p><strong>5. 自定義照片</strong><br>
        點擊「自定義」按鈕可以上傳你自己的照片作為底圖。如果你有黃庭筠的其他照片，或者想用其他女生的照片，都可以上傳並進行射精和羞辱。</p>
        
        <p><strong>6. 清除畫布</strong><br>
        點擊「清除畫布」按鈕可以清除所有射精痕跡和文字，恢復原始圖片。當你射完一輪後，可以清除畫布，重新開始新一輪的射精和羞辱。</p>
      </div>
      
      <div class="modal-buttons">
        <button id="close-help" class="modal-button">關閉</button>
      </div>
    </div>
  </div>
  
  <!-- 左側控制按鈕 (桌面版) -->
  <div id="fixed-controls">
    <button id="exit-aim-mode">退出射精模式</button>
    <button id="enlarge-text">放大文字</button>
    <button id="shrink-text">縮小文字</button>
    <button id="delete-text">刪除文字</button>
  </div>
  
  <!-- 手機版文字控制按鈕 -->
  <div class="mobile-text-controls">
    <button id="mobile-enlarge-text">放大</button>
    <button id="mobile-shrink-text">縮小</button>
    <button id="mobile-delete-text">刪除</button>
  </div>
  
  <!-- 右側功能按鈕 -->
  <div class="right-controls">
    <div id="help-button" title="使用說明">?</div>
  </div>
  
  <div id="shooting-tip">點擊圖片任意位置進行射精</div>
  
  <div class="container">
    <h1>黃庭筠的極致顏射體驗</h1>
    <p class="subtitle">她渴望你的洗禮！盡情羞辱她吧！</p>
    
    <div id="canvas-container">
      <canvas id="main-canvas"></canvas>
      <div id="aim-circle"><div id="aim-center"></div></div>
      <div id="profile-switcher" title="切換預設照片">↻</div>
    </div>
    
    <div class="controls-footer">
      <div class="input-group">
        <input type="text" id="custom-text-input" placeholder="輸入自定義文字">
        <button id="add-text-button" class="button">添加文字</button>
      </div>
      <div class="controls-container">
        <button id="random-text-button" class="button small-button">隨機文字</button>
        <button id="shoot-button" class="button small-button">射爆她！</button>
        <button id="clean-button" class="button small-button">清除畫布</button>
        <button id="custom-mode-button" class="button small-button">自定義</button>
      </div>
    </div>
    <p class="info">玩弄這欠幹婊子！使勁羞辱她！</p>
  </div>

  <script>
    // 狀態管理
    const state = {
      currentProfile: 1,
      totalProfiles: 6, // 更新為6張預設照片
      isAimMode: false,
      selectedText: null,
      textElements: [],
      initialTextsAdded: false,
      isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
    };

    // DOM元素
    const warningScreen = document.getElementById('warning-screen');
    const enterButton = document.getElementById('enter-button');
    const exitButton = document.getElementById('exit-button');
    const loadingScreen = document.getElementById('loading-screen');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const canvasContainer = document.getElementById('canvas-container');
    const mainCanvas = document.getElementById('main-canvas');
    const aimCircle = document.getElementById('aim-circle');
    const customTextInput = document.getElementById('custom-text-input');
    const addTextButton = document.getElementById('add-text-button');
    const randomTextButton = document.getElementById('random-text-button');
    const shootButton = document.getElementById('shoot-button');
    const cleanButton = document.getElementById('clean-button');
    const customModeButton = document.getElementById('custom-mode-button');
    const exitAimModeButton = document.getElementById('exit-aim-mode');
    const enlargeTextButton = document.getElementById('enlarge-text');
    const shrinkTextButton = document.getElementById('shrink-text');
    const deleteTextButton = document.getElementById('delete-text');
    const mobileEnlargeTextButton = document.getElementById('mobile-enlarge-text');
    const mobileShrinkTextButton = document.getElementById('mobile-shrink-text');
    const mobileDeleteTextButton = document.getElementById('mobile-delete-text');
    const mobileTextControls = document.querySelector('.mobile-text-controls');
    const customImageModal = document.getElementById('custom-image-modal');
    const customImageInput = document.getElementById('custom-image-input');
    const customImagePreview = document.getElementById('custom-image-preview');
    const applyCustomImageButton = document.getElementById('apply-custom-image');
    const resetDefaultImageButton = document.getElementById('reset-default-image');
    const cancelCustomImageButton = document.getElementById('cancel-custom-image');
    const profileSwitcher = document.getElementById('profile-switcher');
    const helpButton = document.getElementById('help-button');
    const helpModal = document.getElementById('help-modal');
    const closeHelpButton = document.getElementById('close-help');
    const shootingTip = document.getElementById('shooting-tip');

    // 隨機文字列表
    const randomTexts = [
      '賤貨', '母狗', '騷貨', '精液便器', '肉便器', '公共廁所',
      '婊子', '賤人', '騷逼', '淫蕩', '欠幹', '欠操',
      '賤種', '賤逼', '騷婊', '賤婊', '騷母狗', '賤母狗'
    ];

    // 初始化
    function initializeApp() {
      // 綁定事件
      enterButton.addEventListener('click', startApp);
      exitButton.addEventListener('click', () => window.close());
      addTextButton.addEventListener('click', addCustomText);
      randomTextButton.addEventListener('click', addRandomText);
      shootButton.addEventListener('click', toggleAimMode);
      cleanButton.addEventListener('click', cleanCanvas);
      customModeButton.addEventListener('click', showCustomImageModal);
      exitAimModeButton.addEventListener('click', exitAimMode);
      enlargeTextButton.addEventListener('click', enlargeSelectedText);
      shrinkTextButton.addEventListener('click', shrinkSelectedText);
      deleteTextButton.addEventListener('click', deleteSelectedText);
      mobileEnlargeTextButton.addEventListener('click', enlargeSelectedText);
      mobileShrinkTextButton.addEventListener('click', shrinkSelectedText);
      mobileDeleteTextButton.addEventListener('click', deleteSelectedText);
      customImageInput.addEventListener('change', handleCustomImageSelect);
      applyCustomImageButton.addEventListener('click', applyCustomImage);
      resetDefaultImageButton.addEventListener('click', resetToDefaultImage);
      cancelCustomImageButton.addEventListener('click', hideCustomImageModal);
      profileSwitcher.addEventListener('click', switchProfile);
      helpButton.addEventListener('click', showHelpModal);
      closeHelpButton.addEventListener('click', hideHelpModal);
      
      // 點擊畫布外區域隱藏文字控制按鈕
      document.addEventListener('click', hideTextControlsOnOutsideClick);
      
      // 監聽窗口大小變化，調整畫布大小
      window.addEventListener('resize', resizeCanvas);
    }

    // 開始應用
    function startApp() {
      warningScreen.style.display = 'none';
      loadingScreen.style.display = 'flex';
      
      // 預加載資源
      preloadAssets().then(() => {
        loadingScreen.style.display = 'none';
        
        // 設置初始圖片
        mainCanvas.src = `images/profiles/1.png`;
        
        // 調整畫布大小
        resizeCanvas();
        
        // 添加初始文字
        if (!state.initialTextsAdded) {
          addText('賤貨', 30, 30);
          addText('母狗', canvasContainer.offsetWidth - 100, 30);
          state.initialTextsAdded = true;
        }
      });
    }

    // 預加載資源
    async function preloadAssets() {
      const totalAssets = state.totalProfiles + 15; // 預設照片 + 精液圖片
      let loadedAssets = 0;
      
      // 預加載預設照片
      const profilePromises = [];
      for (let i = 1; i <= state.totalProfiles; i++) {
        const img = new Image();
        const promise = new Promise((resolve) => {
          img.onload = () => {
            loadedAssets++;
            updateProgress(loadedAssets, totalAssets);
            resolve();
          };
          img.onerror = () => {
            loadedAssets++;
            updateProgress(loadedAssets, totalAssets);
            resolve();
          };
        });
        
        // 根據檔案類型設置不同的路徑
        if (i <= 3) {
          img.src = `images/profiles/${i}.png`;
        } else if (i === 4) {
          img.src = `images/profiles/${i}.jpeg`;
        } else {
          img.src = `images/profiles/${i}.jpg`;
        }
        
        profilePromises.push(promise);
      }
      
      // 預加載精液圖片
      const cumPromises = [];
      for (let i = 1; i <= 15; i++) {
        const img = new Image();
        const promise = new Promise((resolve) => {
          img.onload = () => {
            loadedAssets++;
            updateProgress(loadedAssets, totalAssets);
            resolve();
          };
          img.onerror = () => {
            loadedAssets++;
            updateProgress(loadedAssets, totalAssets);
            resolve();
          };
        });
        img.src = `images/cum/${i}.png`;
        cumPromises.push(promise);
      }
      
      // 等待所有資源加載完成
      await Promise.all([...profilePromises, ...cumPromises]);
    }

    // 更新進度條
    function updateProgress(loaded, total) {
      const percentage = Math.floor((loaded / total) * 100);
      progressBar.style.width = `${percentage}%`;
      progressText.textContent = `${percentage}%`;
    }

    // 調整畫布大小
    function resizeCanvas() {
      const containerWidth = canvasContainer.offsetWidth;
      const containerHeight = canvasContainer.offsetHeight;
      
      // 獲取圖片的原始尺寸
      const imgWidth = mainCanvas.naturalWidth || containerWidth;
      const imgHeight = mainCanvas.naturalHeight || containerHeight;
      
      // 計算縮放比例
      const scale = Math.min(
        containerWidth / imgWidth,
        containerHeight / imgHeight
      );
      
      // 計算新尺寸
      const newWidth = imgWidth * scale;
      const newHeight = imgHeight * scale;
      
      // 計算居中位置
      const left = (containerWidth - newWidth) / 2;
      const top = (containerHeight - newHeight) / 2;
      
      // 設置畫布尺寸和位置
      mainCanvas.style.width = `${newWidth}px`;
      mainCanvas.style.height = `${newHeight}px`;
      mainCanvas.style.position = 'absolute';
      mainCanvas.style.left = `${left}px`;
      mainCanvas.style.top = `${top}px`;
    }

    // 添加自定義文字
    function addCustomText() {
      const text = customTextInput.value.trim();
      if (text) {
        const x = Math.random() * (canvasContainer.offsetWidth - 100);
        const y = Math.random() * (canvasContainer.offsetHeight - 50);
        addText(text, x, y);
        customTextInput.value = '';
      }
    }

    // 添加隨機文字
    function addRandomText() {
      const randomIndex = Math.floor(Math.random() * randomTexts.length);
      const text = randomTexts[randomIndex];
      const x = Math.random() * (canvasContainer.offsetWidth - 100);
      const y = Math.random() * (canvasContainer.offsetHeight - 50);
      addText(text, x, y);
    }

    // 添加文字
    function addText(text, x, y) {
      const textElement = document.createElement('div');
      textElement.className = 'target-text';
      textElement.textContent = text;
      textElement.style.left = `${x}px`;
      textElement.style.top = `${y}px`;
      textElement.style.fontSize = '24px';
      
      // 添加拖動功能
      textElement.addEventListener('mousedown', startDragText);
      textElement.addEventListener('touchstart', startDragText, { passive: false });
      
      // 點擊文字顯示控制按鈕
      textElement.addEventListener('click', (e) => {
        e.stopPropagation();
        selectText(textElement);
      });
      
      canvasContainer.appendChild(textElement);
      state.textElements.push(textElement);
    }

    // 開始拖動文字
    function startDragText(e) {
      e.preventDefault();
      
      // 如果在瞄準模式，不允許拖動
      if (state.isAimMode) return;
      
      // 選中當前文字
      selectText(e.target);
      
      const textElement = e.target;
      let startX, startY;
      
      // 獲取起始位置
      if (e.type === 'mousedown') {
        startX = e.clientX;
        startY = e.clientY;
      } else if (e.type === 'touchstart') {
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
      }
      
      // 當前文字位置
      const startLeft = parseInt(textElement.style.left) || 0;
      const startTop = parseInt(textElement.style.top) || 0;
      
      // 移動處理函數
      function moveHandler(moveEvent) {
        let currentX, currentY;
        
        if (moveEvent.type === 'mousemove') {
          currentX = moveEvent.clientX;
          currentY = moveEvent.clientY;
        } else if (moveEvent.type === 'touchmove') {
          currentX = moveEvent.touches[0].clientX;
          currentY = moveEvent.touches[0].clientY;
        }
        
        // 計算位移
        const deltaX = currentX - startX;
        const deltaY = currentY - startY;
        
        // 更新位置
        textElement.style.left = `${startLeft + deltaX}px`;
        textElement.style.top = `${startTop + deltaY}px`;
      }
      
      // 結束拖動處理函數
      function endHandler() {
        document.removeEventListener('mousemove', moveHandler);
        document.removeEventListener('touchmove', moveHandler);
        document.removeEventListener('mouseup', endHandler);
        document.removeEventListener('touchend', endHandler);
      }
      
      // 添加事件監聽
      document.addEventListener('mousemove', moveHandler);
      document.addEventListener('touchmove', moveHandler, { passive: false });
      document.addEventListener('mouseup', endHandler);
      document.addEventListener('touchend', endHandler);
    }

    // 選中文字
    function selectText(textElement) {
      // 取消之前選中的文字
      if (state.selectedText) {
        state.selectedText.style.border = 'none';
        state.selectedText.style.padding = '0';
      }
      
      // 選中新文字
      state.selectedText = textElement;
      textElement.style.border = '1px dashed white';
      textElement.style.padding = '2px';
      
      // 顯示控制按鈕
      showTextControls();
    }

    // 顯示文字控制按鈕
    function showTextControls() {
      if (state.isMobile) {
        // 在手機上顯示底部控制按鈕
        mobileTextControls.style.display = 'flex';
      } else {
        // 在桌面上顯示左側控制按鈕
        enlargeTextButton.style.display = 'block';
        shrinkTextButton.style.display = 'block';
        deleteTextButton.style.display = 'block';
      }
    }

    // 隱藏文字控制按鈕
    function hideTextControls() {
      enlargeTextButton.style.display = 'none';
      shrinkTextButton.style.display = 'none';
      deleteTextButton.style.display = 'none';
      mobileTextControls.style.display = 'none';
      
      if (state.selectedText) {
        state.selectedText.style.border = 'none';
        state.selectedText.style.padding = '0';
        state.selectedText = null;
      }
    }

    // 點擊畫布外區域隱藏文字控制按鈕
    function hideTextControlsOnOutsideClick(e) {
      if (
        !e.target.classList.contains('target-text') &&
        e.target !== enlargeTextButton &&
        e.target !== shrinkTextButton &&
        e.target !== deleteTextButton &&
        e.target !== mobileEnlargeTextButton &&
        e.target !== mobileShrinkTextButton &&
        e.target !== mobileDeleteTextButton
      ) {
        hideTextControls();
      }
    }

    // 放大選中文字
    function enlargeSelectedText() {
      if (state.selectedText) {
        const currentSize = parseInt(state.selectedText.style.fontSize);
        state.selectedText.style.fontSize = `${currentSize + 2}px`;
      }
    }

    // 縮小選中文字
    function shrinkSelectedText() {
      if (state.selectedText) {
        const currentSize = parseInt(state.selectedText.style.fontSize);
        if (currentSize > 10) {
          state.selectedText.style.fontSize = `${currentSize - 2}px`;
        }
      }
    }

    // 刪除選中文字
    function deleteSelectedText() {
      if (state.selectedText) {
        canvasContainer.removeChild(state.selectedText);
        state.textElements = state.textElements.filter(el => el !== state.selectedText);
        state.selectedText = null;
        hideTextControls();
      }
    }

    // 切換瞄準模式
    function toggleAimMode() {
      state.isAimMode = !state.isAimMode;
      
      if (state.isAimMode) {
        // 進入瞄準模式
        exitAimModeButton.style.display = 'block';
        
        // 在手機上顯示提示，不顯示準心
        if (state.isMobile) {
          shootingTip.style.display = 'block';
          setTimeout(() => {
            shootingTip.style.display = 'none';
          }, 2000);
        } else {
          // 在桌面上顯示準心
          aimCircle.style.display = 'block';
          document.addEventListener('mousemove', handleAim);
        }
        
        // 添加點擊事件
        mainCanvas.addEventListener('click', handleShoot);
        mainCanvas.addEventListener('touchend', handleShoot);
      } else {
        // 退出瞄準模式
        exitAimMode();
      }
    }

    // 退出瞄準模式
    function exitAimMode() {
      state.isAimMode = false;
      aimCircle.style.display = 'none';
      exitAimModeButton.style.display = 'none';
      document.removeEventListener('mousemove', handleAim);
      mainCanvas.removeEventListener('click', handleShoot);
      mainCanvas.removeEventListener('touchend', handleShoot);
    }

    // 處理瞄準
    function handleAim(e) {
      // 獲取鼠標相對於畫布容器的位置
      const rect = canvasContainer.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      
      // 更新準心位置，考慮準心的寬高
      const aimWidth = aimCircle.offsetWidth;
      const aimHeight = aimCircle.offsetHeight;
      aimCircle.style.left = `${x - aimWidth/2}px`;
      aimCircle.style.top = `${y - aimHeight/2}px`;
    }

    // 處理射擊
    function handleShoot(e) {
      e.preventDefault();
      
      // 獲取點擊位置
      let x, y;
      
      if (e.type === 'click') {
        x = e.clientX;
        y = e.clientY;
      } else if (e.type === 'touchend') {
        // 使用最後一個觸摸點的位置
        const touch = e.changedTouches[e.changedTouches.length - 1];
        x = touch.clientX;
        y = touch.clientY;
      }
      
      // 獲取相對於畫布容器的位置
      const rect = canvasContainer.getBoundingClientRect();
      const relX = x - rect.left;
      const relY = y - rect.top;
      
      // 創建精液效果
      createSplash(relX, relY);
    }

    // 創建精液效果
    function createSplash(x, y) {
      // 隨機選擇精液圖片
      const randomIndex = Math.floor(Math.random() * 15) + 1;
      const splashImg = document.createElement('img');
      splashImg.src = `images/cum/${randomIndex}.png`;
      splashImg.style.position = 'absolute';
      
      // 隨機大小
      const size = Math.random() * 50 + 70; // 縮小精液尺寸
      splashImg.style.width = `${size}px`;
      splashImg.style.height = 'auto';
      
      // 設置位置，居中顯示
      splashImg.style.left = `${x - size/2}px`;
      splashImg.style.top = `${y - size/2}px`;
      
      // 設置z-index確保在文字上方
      splashImg.style.zIndex = '5';
      
      // 添加到畫布容器
      canvasContainer.appendChild(splashImg);
    }

    // 清除畫布
    function cleanCanvas() {
      // 移除所有精液圖片
      const splashImages = canvasContainer.querySelectorAll('img:not(#main-canvas)');
      splashImages.forEach(img => canvasContainer.removeChild(img));
      
      // 移除所有文字
      state.textElements.forEach(el => canvasContainer.removeChild(el));
      state.textElements = [];
      state.selectedText = null;
      
      // 隱藏控制按鈕
      hideTextControls();
      
      // 重置初始文字標記
      state.initialTextsAdded = false;
      
      // 添加初始文字
      addText('賤貨', 30, 30);
      addText('母狗', canvasContainer.offsetWidth - 100, 30);
      state.initialTextsAdded = true;
    }
    
    // 只清除畫布，不清除文字
    function cleanCanvasOnly() {
      // 移除所有精液圖片
      const splashImages = canvasContainer.querySelectorAll('img:not(#main-canvas)');
      splashImages.forEach(img => canvasContainer.removeChild(img));
    }

    // 顯示自定義圖片模態框
    function showCustomImageModal() {
      customImageModal.style.display = 'flex';
    }

    // 隱藏自定義圖片模態框
    function hideCustomImageModal() {
      customImageModal.style.display = 'none';
      customImagePreview.style.display = 'none';
      customImagePreview.src = '';
      applyCustomImageButton.disabled = true;
    }

    // 處理自定義圖片選擇
    function handleCustomImageSelect(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          customImagePreview.src = event.target.result;
          customImagePreview.style.display = 'block';
          applyCustomImageButton.disabled = false;
        };
        reader.readAsDataURL(file);
      }
    }

    // 應用自定義圖片
    function applyCustomImage() {
      if (customImagePreview.src) {
        mainCanvas.src = customImagePreview.src;
        resizeCanvas();
        hideCustomImageModal();
      }
    }

    // 重置為預設圖片
    function resetToDefaultImage() {
      mainCanvas.src = `images/profiles/${state.currentProfile}.png`;
      resizeCanvas();
      hideCustomImageModal();
    }

    // 切換預設照片
    function switchProfile() {
      // 保存當前文字元素
      const currentTexts = [...state.textElements];
      
      // 切換到下一個預設照片
      state.currentProfile = (state.currentProfile % state.totalProfiles) + 1;
      
      // 根據檔案類型設置不同的路徑
      let profilePath;
      if (state.currentProfile <= 3) {
        profilePath = `images/profiles/${state.currentProfile}.png`;
      } else if (state.currentProfile === 4) {
        profilePath = `images/profiles/${state.currentProfile}.jpeg`;
      } else {
        profilePath = `images/profiles/${state.currentProfile}.jpg`;
      }
      
      // 更新圖片
      mainCanvas.src = profilePath;
      
      // 清除畫布上的精液，但保留文字
      cleanCanvasOnly();
      
      // 調整畫布大小
      resizeCanvas();
    }

    // 顯示幫助模態框
    function showHelpModal() {
      helpModal.style.display = 'block';
    }

    // 隱藏幫助模態框
    function hideHelpModal() {
      helpModal.style.display = 'none';
    }

    // 初始化應用
    initializeApp();
  </script>
</body>
</html>
